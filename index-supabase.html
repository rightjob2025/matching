-- jobsテーブルに業界カテゴリカラムを追加
-- フェーズ1: 検索機能拡張

-- industry_categoryカラムが存在しない場合のみ追加
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.columns 
        WHERE table_name = 'jobs' 
        AND column_name = 'industry_category'
    ) THEN
        ALTER TABLE jobs ADD COLUMN industry_category TEXT;
        COMMENT ON COLUMN jobs.industry_category IS '業界カテゴリ';
    END IF;
END $$;

-- job_experience_ok と industry_experience_ok カラムの確認と追加
DO $$
BEGIN
    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.columns 
        WHERE table_name = 'jobs' 
        AND column_name = 'job_experience_ok'
    ) THEN
        ALTER TABLE jobs ADD COLUMN job_experience_ok TEXT DEFAULT '不可';
        COMMENT ON COLUMN jobs.job_experience_ok IS '職種未経験OK（可/不可）';
    END IF;

    IF NOT EXISTS (
        SELECT 1 
        FROM information_schema.columns 
        WHERE table_name = 'jobs' 
        AND column_name = 'industry_experience_ok'
    ) THEN
        ALTER TABLE jobs ADD COLUMN industry_experience_ok TEXT DEFAULT '不可';
        COMMENT ON COLUMN jobs.industry_experience_ok IS '業界未経験OK（可/不可）';
    END IF;
END $$;

-- 確認用クエリ
SELECT 
    column_name, 
    data_type, 
    column_default,
    is_nullable
FROM information_schema.columns
WHERE table_name = 'jobs'
AND column_name IN ('industry_category', 'job_experience_ok', 'industry_experience_ok')
ORDER BY column_name;
